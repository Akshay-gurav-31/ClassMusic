<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Classes</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: #f3f4f6;
            margin: 0;
            padding: 0;
        }
        .flex {
            display: flex;
        }
        .min-h-screen {
            min-height: 100vh;
        }
        .md\:w-80 {
            width: 20rem;
        }
        .w-3\/4 {
            width: 75%;
        }
        .p-6 {
            padding: 1.5rem;
        }
        .md\:sticky {
            position: sticky;
        }
        .md\:top-0 {
            top: 0;
        }
        .h-screen {
            height: 100vh;
        }
        .overflow-y-auto {
            overflow-y: auto;
        }
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        .text-2xl {
            font-size: 1.5rem;
            line-height: 2rem;
        }
        .font-bold {
            font-weight: 700;
        }
        .text-gray-900 {
            color: #111827;
        }
        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }
        .p-3 {
            padding: 0.75rem;
        }
        .rounded-lg {
            border-radius: 0.5rem;
        }
        .flex {
            display: flex;
        }
        .items-center {
            align-items: center;
        }
        .space-x-2 > * + * {
            margin-left: 0.5rem;
        }
        .mt-6 {
            margin-top: 1.5rem;
        }
        .border-t {
            border-top-width: 1px;
        }
        .pt-4 {
            padding-top: 1rem;
        }
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }
        .font-semibold {
            font-weight: 600;
        }
        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .text-gray-600 {
            color: #4b5563;
        }
        .mt-4 {
            margin-top: 1rem;
        }
        .w-full {
            width: 100%;
        }
        .md\:w-3\/4 {
            width: 75%;
        }
        .p-4 {
            padding: 1rem;
        }
        .md\:p-8 {
            padding: 2rem;
        }
        .mb-4 {
            margin-bottom: 1rem;
        }
        .text-4xl {
            font-size: 2.25rem;
            line-height: 2.5rem;
        }
        .font-extrabold {
            font-weight: 800;
        }
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }
        .bg-gray-200 {
            background-color: #e5e7eb;
        }
        .h-4 {
            height: 1rem;
        }
        .overflow-hidden {
            overflow: hidden;
        }
        .md\:hidden {
            display: none;
        }
        .hidden.md\:flex {
            display: none;
        }
        @media (min-width: 768px) {
            .md\:hidden {
                display: none;
            }
            .md\:flex {
                display: flex;
            }
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .certificate {
            display: none;
            border: 2px solid #4b5e7e;
            padding: 24px;
            text-align: center;
            background: linear-gradient(to bottom, #f9fafb, #e5e7eb);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .certificate.show {
            display: block;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
            background: #ffffff;
            border-right: 1px solid #e5e7eb;
            position: relative;
            z-index: 20;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }
        .sidebar.hidden {
            transform: translateX(-100%);
        }
        .locked {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #e5e7eb !important;
        }
        .video-item {
            transition: background-color 0.2s ease, transform 0.2s ease;
            background-color: #f9fafb;
        }
        .video-item:hover:not(.locked) {
            transform: translateX(4px);
            background-color: #e5e7eb;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
            background-color: #3b82f6;
        }
        .button {
            transition: background-color 0.2s ease, transform 0.2s ease;
            background-color: #3b82f6;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
        }
        .button:hover {
            transform: scale(1.05);
            background-color: #2563eb;
        }
        .content-section {
            margin-bottom: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            background-color: #f3f4f6;
            border-radius: 0.375rem;
        }
        .content-section.collapsed + ul {
            display: none;
        }
        .close-btn {
            font-size: 1.75rem;
            padding: 0.75rem 1rem;
            background-color: #e5e7eb;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background-color: #d1d5db;
            color: #111827;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .menu-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            padding: 0.75rem 1rem;
            background-color: #ffffff;
            color: #111827;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 10;
            display: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .menu-btn:hover {
            color: #374151;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 768px) {
            .menu-btn {
                display: block;
            }
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 30;
                box-shadow: 2px 0 12px rgba(0, 0, 0, 0.1);
            }
            .sidebar-header {
                margin-bottom: 2rem; /* Increased space on mobile */
            }
            /* Add padding to main content to prevent overlap with menu button */
            .main-content {
                padding-top: 4rem !important;
            }
        }
        .sidebar-header {
            margin-bottom: 1.5rem; /* Increased default space */
        }
        /* Add this to create space for the menu button on mobile */
        .main-content {
            position: relative;
            padding-top: 1rem;
        }
    </style>
</head>
<body>
    <button id="menuBtn" class="menu-btn">â˜°</button>
    <div class="flex min-h-screen">
        <!-- Sidebar: Syllabus -->
        <div id="sidebar" class="sidebar md:w-80 w-3/4 p-6 md:sticky md:top-0 h-screen overflow-y-auto">
            <div class="sidebar-header flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-900">Course Syllabus</h2>
                <button id="closeSidebar" class="close-btn">&times;</button>
            </div>
            <div class="content-section text-lg font-semibold text-gray-900" onclick="this.classList.toggle('collapsed')">Content</div>
            <ul id="videoList" class="space-y-3">
                <li class="video-item cursor-pointer p-3 rounded-lg" data-video-id="D3VnE2ntRYE" data-index="0">Introduction to Music Theory</li>
                <li class="video-item cursor-pointer p-3 rounded-lg locked" data-video-id="NmqBE_C52j8" data-index="1">Basic Guitar Chords</li>
                <li class="video-item cursor-pointer p-3 rounded-lg locked" data-video-id="fSrw0uMS-TQ" data-index="2">Rhythm and Timing</li>
            </ul>
            <div class="mt-6 border-t pt-4">
                <h3 class="text-lg font-semibold text-gray-900">Course Details</h3>
                <p class="text-sm text-gray-600">Duration: 3 Weeks</p>
                <p class="text-sm text-gray-600">Level: Beginner</p>
                <p class="text-sm text-gray-600">Instructor: RD Gurav</p>
            </div>
        </div>

        <!-- Main Content: Video and Progress -->
        <div class="main-content md:w-3/4 w-full p-4 md:p-8">
            <button id="openSidebar" class="md:hidden mb-6 bg-blue-600 text-white px-4 py-2 rounded-lg button">Open Syllabus</button>
            <h1 class="text-4xl font-extrabold mb-6 text-gray-900">Music Classes Playlist</h1>
            <div id="videoPlayer" class="video-container mb-6">
                <div id="player"></div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-gray-900">Course Progress</h2>
                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                    <div id="progressBar" class="progress-bar h-4 rounded-full" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-sm mt-2 text-gray-700">0% Complete</p>
                <div id="certificate" class="certificate mt-6">
                    <h2 class="text-2xl font-bold text-gray-900">Certificate of Completion</h2>
                    <p class="text-gray-700">Congratulations! You have completed the Music Classes Course.</p>
                    <button class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg button hover:bg-blue-700" onclick="downloadCertificate()">Download Certificate</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulated user login and payment status
        const user = { isLoggedIn: true, hasPaid: true };

        // Video data with real YouTube IDs
        const videos = [
            { id: 'D3VnE2ntRYE', title: 'Introduction to Music Theory', watched: false },
            { id: 'NmqBE_C52j8', title: 'Basic Guitar Chords', watched: false },
            { id: 'fSrw0uMS-TQ', title: 'Rhythm and Timing', watched: false }
        ];

        // Check user access
        if (!user.isLoggedIn || !user.hasPaid) {
            document.body.innerHTML = '<div class="flex items-center justify-center h-screen"><h1 class="text-center text-3xl font-bold text-gray-900">Please log in and purchase the course to access the content.</h1></div>';
        } else {
            // Initialize elements
            let player;
            const videoItems = document.querySelectorAll('.video-item');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const certificate = document.getElementById('certificate');
            const sidebar = document.getElementById('sidebar');
            const openSidebarBtn = document.getElementById('openSidebar');
            const closeSidebarBtn = document.getElementById('closeSidebar');
            const menuBtn = document.getElementById('menuBtn');

            // Load watched videos from localStorage
            const watchedVideos = JSON.parse(localStorage.getItem('watchedVideos')) || [];
            videos.forEach((video, index) => {
                if (watchedVideos.includes(video.id)) {
                    video.watched = true;
                    document.querySelector(`.video-item[data-index="${index}"]`).classList.remove('locked');
                    document.querySelector(`.video-item[data-index="${index}"]`).classList.add('bg-green-100');
                }
            });

            // Initialize YouTube player with default video
            function onYouTubeIframeAPIReady() {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: 'D3VnE2ntRYE', // Default to Introduction to Music Theory
                    playerVars: {
                        'playsinline': 1,
                        'controls': 1,
                        'rel': 0
                    },
                    events: {
                        'onStateChange': onPlayerStateChange
                    }
                });
            }

            // Track video completion
            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.ENDED) {
                    const currentVideoId = player.getVideoData().video_id;
                    const index = videos.findIndex(video => video.id === currentVideoId);
                    if (index !== -1 && !videos[index].watched) {
                        videos[index].watched = true;
                        const item = document.querySelector(`.video-item[data-index="${index}"]`);
                        item.classList.remove('locked');
                        item.classList.add('bg-green-100');
                        watchedVideos.push(currentVideoId);
                        localStorage.setItem('watchedVideos', JSON.stringify(watchedVideos));
                        updateVideoAccess();
                        updateProgress();
                    }
                }
            }

            // Prevent direct access to locked videos
            function updateVideoAccess() {
                videoItems.forEach((item, index) => {
                    if (index === 0 || videos[index - 1].watched) {
                        item.classList.remove('locked');
                    } else {
                        item.classList.add('locked');
                    }
                });
            }

            // Smooth progress update
            function updateProgress() {
                const watchedCount = videos.filter(v => v.watched).length;
                const progress = (watchedCount / videos.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${Math.round(progress)}% Complete`;
                if (progress === 100) {
                    certificate.classList.add('show');
                }
            }

            // Video click handler
            videoItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('locked')) return; // Block locked videos
                    const videoId = item.getAttribute('data-video-id');
                    player.loadVideoById(videoId);
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('hidden');
                    }
                });
            });

            // Download certificate with current date and time
            function downloadCertificate() {
                const now = new Date();
                const options = { timeZone: 'Asia/Kolkata', hour12: true, hour: '2-digit', minute: '2-digit' };
                const time = now.toLocaleTimeString('en-US', options).toUpperCase().replace(' ', '');
                const date = now.toLocaleDateString('en-US', { timeZone: 'Asia/Kolkata' });
                const link = document.createElement('a');
                link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(`Certificate of Completion\nMusic Classes Course\nAwarded to: [User Name]\nDate: ${date} at ${time} IST`);
                link.download = 'certificate.txt';
                link.click();
            }

            // Sidebar toggle for mobile and desktop close
            openSidebarBtn.addEventListener('click', () => {
                sidebar.classList.remove('hidden');
            });
            closeSidebarBtn.addEventListener('click', () => {
                sidebar.classList.add('hidden');
            });
            menuBtn.addEventListener('click', () => {
                sidebar.classList.remove('hidden');
            });

            // Prevent direct access via URL manipulation
            window.addEventListener('load', () => {
                const currentVideoId = player ? player.getVideoData().video_id : 'D3VnE2ntRYE'; // Default to first video
                const index = videos.findIndex(video => video.id === currentVideoId);
                if (index > 0 && !videos[index - 1].watched) {
                    player.loadVideoById('D3VnE2ntRYE'); // Force load default video if out of sequence
                }
            });

            // Initial setup
            updateVideoAccess();
            updateProgress();
        }
    </script>
</body>
</html>
